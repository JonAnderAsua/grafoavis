<!DOCTYPE html>
<html lang="en">
<head>
    <title>SPARQL Endpoint</title>
<!--    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>-->
    <script type="module">
        //Liburutegien importazioa
        import * as d3 from "https://cdn.skypack.dev/d3@7";
        import {eskaeraEgin} from './js/db.js'

        var botoia = d3.select('#eskaeraButton');
        var goiburuak = d3.select('#goiburuak');
        var parametroak = d3.select('#params');
        var baldintza = d3.select('#eskaera');
        var taula = d3.select('#taula')

        botoia.on('click', function() {
            var eskaera = 'SELECT ' + parametroak.node().value + ' WHERE{ ' + baldintza.node().value + ' }'

            var goiburuPar = parametroak.node().value.split(' ')

            //Goiburuak ezarri
            //for(var i = 0; i < goiburuPar.length; i++){
                //goiburuak.append('th').text(goiburuPar[i])
            //}

            emaitzaEskaera = await eskaeraBurutu(eskaera);
            var goiburuak = []

            //Goiburuak ezarri
            emaitzaEskaera.forEach();
            for(var i = 0; i < Object.keys(emaitzaEskaera) ; i++){
                goiburuak.push(Object.keys(emaitzaEskaera)[i]) 
                goiburuak.append('th').text(Object.keys(emaitzaEskaera)[i]);
            }

            //Taulako elementuak ezarri
            for(var j=0 ; j < emaitzaEskaera.length; j++){
                var tr = taula.append('tr');
                var itema = emaitzaEskaera[j];
                for(var u=0; u < itema.length ; u++){
                    tr.append('th').text(itema['u']);
                }
            }

        })
        async function eskaeraBurutu(eskaera){
            return eskaeraEgin(eskaera);
        }


    </script>
    <style type="text/css">

    </style>
</head>
<body>
<div style="display:flex; flex-direction: column; justify-content: left; align-items:stretch">
    <div style="display:flex; flex-direction: row; justify-content: left; align-items:stretch">
        <label>SELECT&nbsp;</label>
        <input type="text" id="params" value="">
    </div>
    <label>WHERE{</label>
    <textarea rows="5" autocomplete="on" cols="60" id="eskaera"></textarea>
    <label>}</label>
</div>
<button id="eskaeraButton">Eskera egin</button>
<table id="taula">
    <tr id="goiburuak">
<!--        <th>Company</th>-->
<!--        <th>Contact</th>-->
<!--        <th>Country</th>-->
    </tr>
<!--    <tr>-->
<!--        <td>Alfreds Futterkiste</td>-->
<!--        <td>Maria Anders</td>-->
<!--        <td>Germany</td>-->
<!--    </tr>-->
<!--    <tr>-->
<!--        <td>Centro comercial Moctezuma</td>-->
<!--        <td>Francisco Chang</td>-->
<!--        <td>Mexico</td>-->
    </tr>
</table>
</body>
</html>